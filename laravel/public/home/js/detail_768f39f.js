define("autoinvest:page/product/detail/detail.js",function(require,exports,module){"use strict";var $=require("common:widget/lib/jquery/jquery"),tabSelect=require("autoinvest:widget/product/detail/tab/tab"),inputFocus=require("autoinvest:widget/product/detail/status/status"),React=require("common:node_modules/react/react"),ReactDOM=require("common:node_modules/react-dom/index"),numeral=require("common:node_modules/numeral/numeral"),RWETooltip=require("common:widget/react-ui/RWETooltip/RWETooltip"),autoinvestPayWindow=require("autoinvest:widget/product/detail/pay-popup/pay-popup");module.exports={init:function(data){tabSelect.init(data),inputFocus.init(),this.renderTooltip(),this.bindEvent()},renderTooltip:function(){var tooltipProps={id:"product-autoinvest-tooltip-rate",place:"right",tip:"预期年化利率不代表实际利息收益",delayHide:100},tooltip={id:"product-autoinvest-tooltip-invest",place:"right",tip:"加入时确定，后续月份不可修改",delayHide:100};ReactDOM.render(React.createElement(RWETooltip,tooltipProps),document.getElementById("product-autoinvest-tooltip-rate")),ReactDOM.render(React.createElement(RWETooltip,tooltip),document.getElementById("product-autoinvest-tooltip-invest"))},bindEvent:function(){var _this=this;$("#autoinvest-product-buy-amount").on("keyup",function(e){_this.checkInput(e)}),$("#autoinvest-product-buy").on("click",function(e){if(!_this.checkInput(e))return!1;if("null"==window.tplConf.user.userId)return window.location.href="/pc/passport/index/login",!1;if(_this.checkInput(e)&&$(this).data("continue-join")){var dataSource=$(".autoinvest-product .status-wrap");return new autoinvestPayWindow({type:"INFO",data:{nickname:dataSource.data("nickname"),day:dataSource.data("invest-day"),count:dataSource.data("count")},submitCallback:function(){_this.alertPayModal("autoinvest-continue-pay")}}).show(),!1}_this.checkInput(e)&&_this.alertPayModal()})},paySubmitCallback:function(data){var couponId=data.couponId,autoInvestPlanId=$(".autoinvest-product .status-wrap").data("autoinvest-id"),amountStr=data.amount,form=$("<form></form>");form.attr("action","/pc/autoinvest/product/autoinvestProductBuy"),form.attr("method","post"),form.attr("target","_self");var iptCouponId=$('<input type="text" name="couponId" />'),iptAutoInvestPlanId=$('<input type="text" name="autoInvestPlanId" />'),iptAmountStr=$('<input type="text" name="amountStr" />');iptCouponId.attr("value",couponId),iptAutoInvestPlanId.attr("value",autoInvestPlanId),iptAmountStr.attr("value",amountStr),form.append(iptCouponId),form.append(iptAutoInvestPlanId),form.append(iptAmountStr),$(document.body).append(form),form.submit()},alertPayModal:function(id){var _this=this,buyBtn=$("#autoinvest-product-buy"),amount=$("#autoinvest-product-buy-amount").val(),period=buyBtn.data("lock-period"),rate=buyBtn.data("rate"),investDay=buyBtn.data("invest-day"),name=buyBtn.data("autoinvest-name"),dueAccountMoney=buyBtn.data("account-money"),autoinvestId=$(".autoinvest-product .status-wrap").data("autoinvest-id"),payWindow=new autoinvestPayWindow({type:"PAY",data:{name:name,amount:amount,period:period,rate:rate,investDay:investDay,dueAccountMoney:dueAccountMoney,autoinvestId:autoinvestId},id:id,submitCallback:_this.paySubmitCallback});payWindow.show()},showInputTip:function(msg){var tip=$("#autoinvest-product-input-tip");tip.html(msg),tip.show()},checkInput:function(e){var input=$("#autoinvest-product-buy-amount"),joinBtn=$("#autoinvest-product-buy"),val=input.val(),min=input.data("min"),max=input.data("max");min=parseInt(min.toString().replace(/,/g,"")),max=parseInt(max.toString().replace(/,/g,""));var increment=input.data("increment-money");if(!val)return"keyup"==e.type?($("#autoinvest-product-input-tip").hide(),input.css({borderColor:"#ebebeb"}),joinBtn.removeClass("disabled")):(this.showInputTip("您最少购买"+numeral(min).format(",")+"元"),input.css({borderColor:"#FF721F"}),joinBtn.addClass("disabled")),!1;if(val.indexOf(" ")>=0||isNaN(val))return this.showInputTip("请输入正确的金额"),input.css({borderColor:"#FF721F"}),joinBtn.addClass("disabled"),!1;if(0>val&&input.val(Math.abs(val)),min>val)return this.showInputTip("您最少购买"+numeral(min).format(",")+"元"),input.css({borderColor:"#FF721F"}),joinBtn.addClass("disabled"),!1;if(val>max)return this.showInputTip("您最多只能购买"+numeral(max).format(",")+"元"),input.css({borderColor:"#FF721F"}),joinBtn.addClass("disabled"),!1;if(min==increment){if(val%increment!=0)return this.showInputTip("输入金额需为"+numeral(increment).format(",")+"元的整数倍"),input.css({borderColor:"#FF721F"}),joinBtn.addClass("disabled"),!1}else if((val-min)%increment!=0)return this.showInputTip("递增金额需为"+numeral(increment).format(",")+"元的整数倍"),input.css({borderColor:"#FF721F"}),joinBtn.addClass("disabled"),!1;return $("#autoinvest-product-input-tip").hide(),input.css({borderColor:"#ebebeb"}),joinBtn.removeClass("disabled"),!0}}});